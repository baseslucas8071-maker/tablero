<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Visor de Estado PAD</title>
<style>
  :root{
    --bg:#071027; --card:#08203a; --muted:#cfe8ff;
    --header-h-1:48px; --header-h-2:44px;
    --pozo-font-size:20px; --stock-font-size:14px; --cell-font-size:19px;
    --w-id:54px; --w-seq:84px;   /* ancho ajustado para “F/h TPN” */
    --reel-gap:8px; --reel-pad:10px; --reel-num-size:20px; --reel-date-size:18px;
    --row-h:44px;
    --nudge-x:0px; --nudge-y:0px;
    --overscan:0px;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Segoe UI,Arial,sans-serif}
  .wrap{padding:calc(14px + var(--overscan));box-sizing:border-box;display:flex;flex-direction:column;height:100%;transform:translate(var(--nudge-x),var(--nudge-y));transition:transform .25s ease;}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  header h1{margin:0;font-size:28px;letter-spacing:.6px}
  header .meta{opacity:.9;font-size:13px;color:#9fd7ff}
  .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .btn{background:#0b61a8;border:none;color:#fff;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
  .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,.08)}
  .switch{display:flex;align-items:center;gap:8px;font-size:14px;color:var(--muted);cursor:pointer}
  main{flex:1;margin-top:12px;display:flex;min-height:0}
  .board{flex:1;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.01));border-radius:10px;padding:12px;box-sizing:border-box;display:flex;flex-direction:column}
  .table-container{flex:1;overflow:auto;border-radius:8px;position:relative;min-height:0}
  table{border-collapse:collapse;width:100%;min-width:1280px}
  th,td{border:1px solid rgba(255,255,255,.06);padding:8px 10px;text-align:center;white-space:nowrap}
  thead th{background:var(--bg);box-shadow:0 2px 0 rgba(0,0,0,.25)}
  thead tr:first-child th{position:sticky;top:0;z-index:11;height:var(--header-h-1)}
  thead tr:nth-child(2) th{position:sticky;top:var(--header-h-1);z-index:12;height:var(--header-h-2)}
  tbody td{height:var(--row-h);background:transparent;color:#e6f7ff;transition:background .15s ease}
  tbody tr.alt td{background:rgba(255,255,255,.01)}
  tbody tr:hover td{background:rgba(255,255,255,.03)}
  th.rowid,td.rowid{position:sticky;left:0;z-index:20;width:var(--w-id);}
  td.rowid{font-weight:800;color:#bfe8ff;background:#0c1833}
  th.seq,td.seq{width:var(--w-seq);min-width:var(--w-seq);max-width:var(--w-seq)}
  td.seq{font-weight:800;color:#00ff9c;letter-spacing:.4px;text-shadow:0 0 6px rgba(0,255,160,.7),0 0 12px rgba(0,255,160,.35);background:rgba(0,255,160,.05)}
  .pozoTop{font-size:var(--pozo-font-size);font-weight:800;letter-spacing:.6px;position:relative}
  td[data-col^="Pozo"], td[data-col^="Estado"]{font-size:var(--cell-font-size)}
  .subind{font-size:12px;color:#bfe8ff;margin-top:4px;font-weight:600;opacity:.95}
  #fractureTotal, #remainingStages { font-size:17px; }
  footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px;font-size:13px;color:#cfe8ff;gap:10px}
  #dimVeil{position:fixed;inset:0;pointer-events:none;background:#000;opacity:0;transition:opacity .4s ease;z-index:9996}
  #saver{position:fixed;inset:0;display:none;z-index:9997;background:radial-gradient(1200px 700px at var(--blob-x,40%) var(--blob-y,35%),rgba(0,163,255,.12),rgba(0,0,0,.85) 70%);}
  .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);z-index:9998}
  .modal-card{width:min(860px,96vw);max-height:90vh;overflow:auto;background:var(--card);border:1px solid rgba(255,255,255,.1);border-radius:12px;padding:16px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
  html.is-tv .wrap{ transform:none !important; }
  html.is-tv #saver{ backdrop-filter:none; }
  html.is-tv .bImg, html.is-tv .fallImg{ filter:none; }
  html.is-tv thead th{ -webkit-transform:translateZ(0); transform:translateZ(0); }
</style>
</head>
<body>
<div id="dimVeil"></div>
<div id="saver"><div id="saverStage"></div></div>
<div class="wrap">
  <header>
    <div>
      <h1>Visor de Estado PAD</h1>
      <div class="meta">Actualiza automáticamente</div>
    </div>
    <div class="controls">
      <label class="switch"><input id="autoScroll" type="checkbox" /> Auto-scroll (últimas 7)</label>
      <button class="btn" id="btnRefresh">Forzar actualización</button>
      <button class="btn secondary" id="btnPause">Pausar</button>
      <button class="btn secondary" id="btnFull">Pantalla completa</button>
      <button class="btn secondary" id="btnSettings">Ajustes</button>
    </div>
  </header>
  <main>
    <div class="board">
      <div class="bar">
        <div class="stockwrap"><div class="stocklabel">STOCK ACTUAL:</div><div id="stockBar" class="stockbar"></div></div>
        <div class="indicators">
          <div class="ind">
            <div id="fractureTotal">Total fracturas: 0</div>
            <div id="remainingStages" class="subind">Etapas restantes: 0</div>
          </div>
          <div id="datesReel" class="reel"></div>
        </div>
      </div>
      <div class="table-container" id="tableContainer">
        <table id="mainTable">
          <thead>
            <tr id="hdrTop"><th class="rowid">#</th></tr>
            <tr id="hdrSub"><th class="rowid">&nbsp;</th></tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <footer><div id="footerLeft"><span>Última actualización: <strong id="lastUpdate">-</strong></span><span id="delta" class="delta"></span><span id="netStatus" class="pill status">Conectando…</span></div><div class="meta">Actualiza cada <span id="refreshSec">15</span>s</div></footer>
    </div>
  </main>
</div>
<div id="settingsModal" class="modal"><div class="modal-card"><div class="modal-head"><strong>Ajustes rápidos</strong></div>
  <div class="modal-body"><section class="grid g3"><label>Tamaño “POZO #n”<input type="number" id="setPozoFont"></label><label>Tamaño “STOCK”<input type="number" id="setStockFont"></label><label>Tamaño datos<input type="number" id="setCellFont"></label></section></div>
  <div class="modal-actions"><button class="btn secondary" id="btnCloseSettings">Cerrar</button><button class="btn" id="btnSaveSettings">Guardar</button></div></div></div>
<script>
document.addEventListener('DOMContentLoaded',()=>{
  const ROWS=60,POZOS=6;
  const hdrTop=document.getElementById('hdrTop'),hdrSub=document.getElementById('hdrSub'),tbody=document.getElementById('tbody');
  function canonicalizeName(r){return (r||'').toString().toUpperCase();}
  let DISPLAY={pozoFont:20,stockFont:16,cellFont:19};
  function initializeDOM(){
    for(let i=1;i<=POZOS;i++){
      const thTop=document.createElement('th');thTop.className=`pozo-${i} pozoTop`;thTop.colSpan=3;thTop.innerText=`POZO #${i}`;hdrTop.appendChild(thTop);
      const thSeq=document.createElement('th');thSeq.className='seq';thSeq.innerText='F/h TPN';hdrSub.appendChild(thSeq);
      const th1=document.createElement('th');th1.innerText='TPN';hdrSub.appendChild(th1);
      const th2=document.createElement('th');th2.innerText='FRACTURADO';hdrSub.appendChild(th2);
    }
    for(let i=1;i<=ROWS;i++){
      const tr=document.createElement('tr');tr.dataset.rowId='#'+String(i).padStart(2,'0');
      const tdId=document.createElement('td');tdId.className='rowid';tdId.innerText='#'+String(i).padStart(2,'0');tr.appendChild(tdId);
      for(let p=1;p<=POZOS;p++){const tdS=document.createElement('td');tdS.dataset.col=`Seq${p}`;tdS.className='seq';tr.appendChild(tdS);const td1=document.createElement('td');td1.dataset.col=`Pozo${p}`;tr.appendChild(td1);const td2=document.createElement('td');td2.dataset.col=`Estado${p}`;tr.appendChild(td2);}tbody.appendChild(tr);
    }
  }
  function saveSettings(){
    const rulesBody=document.getElementById('rulesBody'); // si existiera
    const rows=[...(rulesBody?.querySelectorAll('.rule-row')||[])];const next={};
    for(const r of rows){
      const name=r.querySelector('[data-f=name]').value,unit=r.querySelector('[data-f=unit]').value;
      const low=+r.querySelector('[data-f=low]').value,mid=+r.querySelector('[data-f=mid]').value;
      if(!name) continue;const canon=canonicalizeName(name);
      next[canon]={display:name.trim(),unit:(unit||'').trim(),low:Number.isFinite(low)?low:0,mid:Number.isFinite(mid)?mid:0};
    }
  }
  initializeDOM();
});
</script>
</body>
</html>

