<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tabla Pozos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .table-container {
      width: 100%;
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #ccc;
      margin-top: 20px;
      position: relative;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 6px;
      text-align: center;
      font-size: 14px;
    }
    thead th {
      position: sticky;
      top: 0;
      background: #f4f4f4;
      z-index: 2;
    }
    tbody tr:nth-child(even) {
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <h2>Monitoreo de Pozos</h2>
  <div class="table-container">
    <table id="pozosTable">
      <thead>
        <tr id="headerRow">
          <th>#</th>
          <th>POZO #1 AAA</th>
          <th>TPN</th>
          <th>FRACTURADO</th>
          <th>POZO #2 7777</th>
          <th>TPN</th>
          <th>FRACTURADO</th>
          <!-- más pozos dinámicos -->
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- filas dinámicas -->
      </tbody>
    </table>
  </div>

  <script>
    async function fetchData() {
      try {
        const response = await fetch("status.json?nocache=" + new Date().getTime());
        const data = await response.json();

        // 1. Actualizar encabezados dinámicamente
        const headerRow = document.getElementById("headerRow");
        headerRow.innerHTML = ""; // limpiar encabezados
        headerRow.appendChild(document.createElement("th")).textContent = "#";

        data.headers.forEach(h => {
          const thPozo = document.createElement("th");
          thPozo.textContent = h.pozo;
          headerRow.appendChild(thPozo);

          const thTPN = document.createElement("th");
          thTPN.textContent = "TPN";
          headerRow.appendChild(thTPN);

          const thFrac = document.createElement("th");
          thFrac.textContent = "FRACTURADO";
          headerRow.appendChild(thFrac);
        });

        // 2. Actualizar filas de datos sin duplicar
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = ""; // limpiar tabla

        data.rows.forEach((row, index) => {
          const tr = document.createElement("tr");
          const tdIndex = document.createElement("td");
          tdIndex.textContent = index + 1;
          tr.appendChild(tdIndex);

          row.forEach(cell => {
            const td = document.createElement("td");
            td.textContent = cell;
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        // 3. Autoscroll si hay más de 9 filas
        const container = document.querySelector(".table-container");
        if (tbody.rows.length > 9) {
          container.scrollTop = container.scrollHeight;
        }

      } catch (error) {
        console.error("Error al cargar datos:", error);
      }
    }

    // Refrescar cada 5s
    setInterval(fetchData, 5000);
    fetchData();
  </script>
</body>
</html>
